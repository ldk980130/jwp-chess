<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
    <link rel="stylesheet" href="css/login.css">
</head>
<body>
<div class="login-container">
    <div class="login-title-wrap">
        <img src="images/white_q.png" class="icon-image">
        <img src="images/white_n.png" class="icon-image">
        <img src="images/white_p.png" class="icon-image">
        <h2 class="login-title">Welcome Chess</h2>
        <img src="images/black_k.png" class="icon-image">
    </div>
    <form action="http://localhost:8080/rooms" onsubmit="return checkNameNotEmpty();" method="post">
        <input type="text" id="name" name="name" placeholder="방 이름" class="input-name">
        <button type="submit" class="input-button">입장</button>
    </form>
    <span id="error-message"></span>
    <button onclick="fetchRoomNames()">방 목록</button>
    <div id="roomNames" class="room-names">
    </div>
</div>
</body>
<script type="text/javascript">
    function checkNameNotEmpty() {
        let name = document.getElementById('name').value.trim();
        if (name === '' || name.length > 12) {
            document.getElementById('error-message').innerHTML = "닉네임 길이는 1자 이상, 12자 이하입니다.";
            return false;
        }
        return true;
    }

    function fetchRoomNames() {
        fetch("http://localhost:8080/rooms", {
            method: 'GET',
            headers: {
                'Content-type': 'application/json; charset=UTF-8',
            },
        })
            .then(res => res.json())
            .then(res => {
                let roomContainer = document.getElementById("roomNames");
                roomContainer.innerHTML = "";
                for (let i = 0; i < res.length; i++) {
                    let button = document.createElement("button");
                    button.innerHTML = '삭제';
                    button.onclick = function () {
                        fetchDeleteRoom(res[i].id)
                    };
                    roomContainer.appendChild(button);

                    let link = document.createElement("a");
                    link.innerHTML = res[i].name + '<br>';
                    link.href = 'http://localhost:8080/rooms/' + res[i].id;
                    roomContainer.appendChild(link);
                }
            });
    }

    function fetchDeleteRoom(roomId) {
        fetch("http://localhost:8080/rooms/" + roomId, {
            method: 'DELETE',
            headers: {
                'Content-type': 'application/json; charset=UTF-8',
            },
        })
            .then(res => alert("방이 삭제되었습니다."))
    }
</script>

</html>